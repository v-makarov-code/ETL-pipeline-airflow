# Построение ETL-пайплайна

## Методология
![dag](https://github.com/v-makarov-code/ETL-pipeline-airflow/blob/main/Airflow_dag_table_update.png)
- Параллельно обрабатывается две таблицы. В feed_actions для каждого юзера посчитаем число просмотров и лайков контента. В message_actions для каждого юзера считаем, сколько он получает и отсылает сообщений, скольким людям он пишет, сколько людей пишут ему. Каждая выгрузка в отдельном таске.
- Объединяем две таблицы в одну.
- Для этой таблицы считаем все эти метрики в разрезе по полу, возрасту и ос. Три разных таска на каждый срез.
- И финальные данные со всеми метриками записываем в отдельную таблицу в ClickHouse.
- Каждый день таблица дополняться новыми данными.

## Структура таблицы
![table_example](https://github.com/v-makarov-code/ETL-pipeline-airflow/blob/main/table_example.png)
- Дата - event_date
- Название среза - dimension
- Значение среза - dimension_value
- Число просмотров - views
- Число лайков - likes
- Число полученных сообщений - messages_received
- Число отправленных сообщений - messages_sent
- От скольких пользователей получили сообщения - users_received
- Скольким пользователям отправили сообщение - users_sent
- Срез — это os, gender и age
